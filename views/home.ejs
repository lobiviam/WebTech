<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My app</title>
</head>
<body>
    <ul id="list">
        <% posts.forEach(function(post) { %>
            <li>
                <%=post.text %>
                <button class="delete_btn" id="<%=post.id %>">x</button>
            </li>
        <% });%>
    </ul>
    <input id="input" type="text">
    <button id="send">Send</button>
</body>
<script>
    document.querySelector('#send').addEventListener('click', function () {
        var text = document.querySelector('#input').value;
        var req = new XMLHttpRequest();
        req.open('post', 'new?text=' + encodeURIComponent(text));
        req.addEventListener('load', function () {
            location.reload();
        });
        //Optimistic update
//        req.send();
//        var list = document.querySelector('#list');
//        var el = document.createElement('li');
//        el.innerHTML = text;
//        list.appendChild(el);
    })
        var btns = document.querySelectorAll('.delete_btn');
        for (var i=0; i<btns.length, i++) {
            btns[i].addEventListener('click', function () {
                var req = new XMLHttpRequest();
                req.open('delete', 'delete?id=' + encodeURIComponent(this.id));
                req.addEventListener('load', function () {
                    location.reload();
                });
                req.send();
            })
        }
</script>
</html>